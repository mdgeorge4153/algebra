<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8"/>
  <script src="html.js"></script>
  <script src="biginteger.js"></script>
  <script src="numbers.js"></script>


  <script>
    function toDomTable(results) {
      var header = TR(TH("test"), TH("result"));
      var rows   = [header];

      for (var i in results) {
        var result = results[i];
        var output = [];

        /* check for exceptions */
        var excs = [];
        for (var exc in result.exc)
          excs.push(LI(B("(",result.exc[exc].length,
                         "/",result.num, ")"),
                       exc));

        if (excs.length > 0)
          output.push(P({"class": "excs"},
                        "some exceptions were thrown:",
                        UL.apply(null, excs)));

        /* list failed test cases */
        var fails = [];
        for (var j in result.fail)
          fails.push(LI("test: " + result.fail[j]));

        if (fails.length > 3)
          fails = [
            fails[0],
            fails[1],
            fails[2],
            LI("... and ",fails.length - 3," others")
          ];

        if (fails.length > 0)
          output.push(P({"class": "fails"},
                        "some tests failed:",
                        UL.apply(null, fails)));

        /* all tests pass! */
        if (output.length === 0)
          output.push(P({"class": "success"},
                        "all ", result.num, " tests pass"));

        /* add output */
        rows.push(TR(TD(i), TD.apply(null, output)));
      }

      return TABLE.apply(null, rows);
    }

    function test(set, objects) {
      document.body.appendChild(toDomTable(runTests(set,objects)));
    }
  </script>


  <style type="text/css">
    table { border-collapse: collapse; }
    td { vertical-align: top; border: 1px solid black; }
    th { text-align: left; }
    p         { margin: 0; }
    ul        { margin: 0; }
    p.fails   { background: #FFCCCC; }
    p.excs    { background: #CCCCFF; }
    p.success { background: #CCFFCC; }
  </style>
  </head>

<body>

<h1>html library test</h1>
<script>
document.body.appendChild(example());
</script>

<h1>Float tests</h1>
<script>
test(floats, [0.0, 1e-35, -1e-35, 23.4, 1e35, -1e35, 1, -1, 0.5, Infinity]);
</script>

<h1>Int tests</h1>
<script>
test(ints,   [0, 1, -1, 42, -42, 10000000000000].map(BigInteger));
</script>

<h1>Rational tests</h1>
<script>
var tests = [[0,1], [0,10], [1,1], [1,2], [2,4], [-2,4], [2,-4], [-2,-4], [7,2]];
function mkFrac (test) {
  return rats.fromInts(test[0],test[1]);
}
test(rats, tests.map(mkFrac));
</script>

</body>
</html>

